<h1 id="Decode_streams_into_strings_The_Right_Way(tm)">Decode streams into strings The Right Way(tm)</h1><pre><code class="javascript"><span class="keyword">var</span> fs   = <span class="built_in">require</span>(<span class="string">'fs'</span>)
<span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)
<span class="keyword">var</span> strs = <span class="built_in">require</span>(<span class="string">'stringstream'</span>)

<span class="keyword">var</span> utf8Stream = fs.createReadStream(<span class="string">'massiveLogFile.gz'</span>)
  .pipe(zlib.createGunzip())
  .pipe(strs(<span class="string">'utf8'</span>))
</code></pre>
<p>No need to deal with <code>setEncoding()</code> weirdness, just compose streams<br>like they were supposed to be!</p>
<p>Handles input and output encoding:</p>
<pre><code class="javascript"><span class="comment">// Stream from utf8 to hex to base64... Why not, ay.</span>
<span class="keyword">var</span> hex64Stream = fs.createReadStream(<span class="string">'myFile'</span>)
  .pipe(strs(<span class="string">'utf8'</span>, <span class="string">'hex'</span>))
  .pipe(strs(<span class="string">'hex'</span>, <span class="string">'base64'</span>))
</code></pre>
<p>Also deals with <code>base64</code> output correctly by aligning each emitted data<br>chunk so that there are no dangling <code>=</code> characters:</p>
<pre><code class="javascript"><span class="keyword">var</span> stream = fs.createReadStream(<span class="string">'myFile'</span>).pipe(strs(<span class="string">'base64'</span>))

<span class="keyword">var</span> base64Str = <span class="string">''</span>

stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{ base64Str += data })
stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'My base64 encoded file is: '</span> + base64Str) <span class="comment">// Wouldn't work with setEncoding()</span>
  <span class="built_in">console</span>.log(<span class="string">'Original file is: '</span> + <span class="keyword">new</span> Buffer(base64Str, <span class="string">'base64'</span>))
})
</code></pre>
